<!DOCTYPE html>
<html lang="en">
<head>

<style type="text/css">
.black_overlay {
	display: none;
	position: absolute;
	top: 0%;
	left: 0%;
	width: 100%;
	height: 100%;
	background-color: black;
	z-index: 1001;
	-moz-opacity: 0.8;
	opacity: .80;
	filter: alpha(opacity = 88);
}

.white_content {
	display: none;
	position: absolute;
	top: 25%;
	left: 25%;
	width: 55%;
	height: 55%;
	padding: 20px;
	border: 2px solid black;
	background-color: white;
	z-index: 1002;
	overflow: auto;
}
</style>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>“火星”车联网系统</title>
<link rel="stylesheet" href="web/assets/css/layout.css">
</head>
<body>
	<div class="page-container">
		<h1>基于位置感知的车辆定位系统</h1>
	</div>
	<div class="page-heng">
		<div class="container">
			<table class="intable-top">
				<tr>
					<td><label>用户名</label></td>
					<td><input type="text" name="username" class="username"
						placeholder="请输入您的用户名" /></td>
				</tr>
				<tr>
					<td><label> 密 码 </label></td>
					<td><input type="password" name="password" class="password"
						placeholder="请输入您的密码" /></td>
				</tr>
			</table>
			<table>
				<tr>
					<td>
						<button name="send" id="login">登 录</button>
					</td>
					<td>
						<button name="manager" id="admister">管理员</button>
					</td>
					<td>
						<button name="send"
							onclick="document.getElementById('light').style.display='block';document.getElementById('fade').style.display='block'">注
							册</button>
						<div id="light" class="white_content">
							<h3>注册</h3>
							
							<table class="intable-top">
				<tr>
					<td><label>用户名</label></td>
					<td><input type="text" name="username1" class="username"
						placeholder="请输入您的用户名" /></td>
				</tr>
				<tr>
					<td><label> 密 码 </label></td>
					<td><input type="password" name="password1" class="password"
						placeholder="请输入您的密码" /></td>
				</tr>
								<tr>
					<td><label> 车牌号 </label></td>
					<td><input type="text" name="devId1" class="devId"
						placeholder="请输入您的车牌号" /></td>
				</tr>
			</table>
							<button onclick="document.getElementById('light').style.display='none';document.getElementById('fade').style.display='none'" id="zhuce">注  册</button>
							<button onclick="document.getElementById('light').style.display='none';document.getElementById('fade').style.display='none'">关闭</button>
						
						</div>
						<div id="fade" class="black_overlay"></div>
					</td>
				</tr>
			</table>
			<!--<p style="color:red;font-weight:bold;"><%=msg %></p>-->
		</div>
	</div>
	<h2>北京邮电大学联合研发</h2>

	<script src="http://code.jquery.com/jquery-2.1.1.min.js"
		type="text/javascript"></script>
	<script type="text/javascript">
		$(function() {
			$('#zhuce').on('click', function() {
				var username = $('input[name=username1]').val();
				var password = $('input[name=password1]').val();
				var devId = $('input[name=devId1]').val();
				$.ajax({
					type : 'post',
					url : 'RegisterServlet',
					data : {
						'username' : username,
						'password' : password,
						'devId' : devId
					//'flag':"user"
					},
					dataType : 'text',
					success : function(res, status) {
						console.log(res)
						alert(res);
					},
					error : function(res, status) {
						alert(res);
					}
				});
			});

			$('#login').on('click', function() {
				var username = $('input[name=username]').val();
				var password = $('input[name=password]').val();

				$.ajax({
					type : 'post',
					url : 'DoLoginServlet',
					data : {
						'username' : username,
						'password' : password
					//'flag':"user"
					},
					dataType : 'json',
					success : function(res, status) {
						console.log(res)
						var name = res.name;
						var grade = res.grade;
						var devId = res.devId;
						//写入sessionstorage
						sessionStorage.userGrade = grade;
						sessionStorage.name = name;
						sessionStorage.devId = devId;
						//                        window.location.href = "wmap.jsp?grade=" + grade + "&devId=" + devId;
						//判断当前客户端是否为PC
						if (IsPC()) {
							window.location.href = "wmap.html";//此处为PC端网页
						} else {
							window.location.href = "index.html";
						}

					},
					error : function(res, status) {
						alert("用户名或密码错误");
					}
				});
			});
			$('#admister').on('click', function() {
				var username = $('input[name=username]').val();
				var password = $('input[name=password]').val();

				$.ajax({
					type : 'post',
					url : 'DoLoginServlet',
					data : {
						'username' : username,
						'password' : password
					},
					dataType : 'json',
					success : function(res, status) {
						//判断是否为管理员账户
						if (res.grade == "3") {
							sessionStorage.userGrade = res.grade;
							sessionStorage.user = username;
							//alert(sessionStorage.user +"");
							window.location.href = "manage.html";
						} else {
							alert("非管理员账户，禁止登陆");
						}
					},
					error : function(res, status) {
						alert("Error！");
					}
				});

			});
		});
		/**
		 * 判断当前客户端是手机还是PC
		 * return：true--PC；false--手机
		 * @constructor
		 */
		function IsPC() {
			var userAgentInfo = navigator.userAgent;
			var Agents = [ "Android", "iPhone", "SymbianOS", "Windows Phone",
					"iPad", "iPod" ];
			var flag = true;
			for (var v = 0; v < Agents.length; v++) {
				if (userAgentInfo.indexOf(Agents[v]) > 0) {
					flag = false;
					break;
				}
			}
			return flag;
		}
	</script>
</body>
</html>